<project name="DacapoFop" default="all">
    <description>Dacapo fop benchmark</description>
    
	<property file="dacapo.properties"/>
	
	<property name="bm.name" value="fop"/>
    <property name="bm.version" value="0.94"/>
    <property name="bm.url" value="${apache.dl.url}/xmlgraphics/fop/source"/>

    <!-- Download and build -->
    <target name="all" description="download and build the benchmark">
      <antcall target="source"/>
      <antcall target="build"/>
    </target>
    
    <!-- Download the source -->
    <target name="source" description="download the benchmark">
        <get src="${bm.url}/${bm.name}-${bm.version}-src.tar.gz"
         dest="${sources}/${bm.name}-${bm.version}.tar.gz"
       usetimestamp="true"/>
    </target>

	<!-- Build the benchmark and harness -->
    <target name="build" depends="benchmark,harness" description="build the benchmark"/>
	
    <!-- Build the benchmark harness -->
    <target name="harness">
		<javac srcdir="${bmsrc}" classpath="${build}:${jars}/fop.jar" destdir="${build}"
		   source="1.5"
    	   includes="dacapo/${bm.name}/*"
           debug="true" debuglevel="lines,vars,source"/>
    </target>

    <!-- Build the benchmark -->
    <target name="benchmark" depends="source">
        <property name="top" value="${build.src}/${bm.name}/${bm.name}-${bm.version}"/>

        <!-- Untar the source distribution -->
        <mkdir dir="${build.src}/${bm.name}/"/>
        <untar src="${sources}/${bm.name}-${bm.version}.tar.gz" dest="${build.src}/${bm.name}/" compression="gzip"/>

        <!-- Apply the dacapo patch, which allows us to set the arguments -->
        <patch patchfile="${patches}/${bm.name}.patch" 
                 dir="${top}"
                 strip="0" ignorewhitespace="yes"/>
    	
        <!-- Build with ant -->
    	<ant dir="${top}" inheritall="false"/>

        <!-- Install the test data -->
        <zip basedir="${data}" includes="${bm.name}/**" destfile="${zipdata}/${bm.name}.zip"/>
    	
    	<!-- Install the jars -->
    	<copy file="${top}/build/fop.jar" todir="${jars}"/>
		<copy file="${top}/lib/avalon-framework-4.2.0.jar" todir="${jars}"/>
		<copy file="${top}/lib/batik-all-1.6.jar" todir="${jars}"/>
		<copy file="${top}/lib/commons-io-1.3.1.jar" todir="${jars}"/>
		<copy file="${top}/lib/commons-logging-1.0.4.jar" todir="${jars}"/>
		<copy file="${top}/lib/serializer-2.7.0.jar" todir="${jars}"/>
		<copy file="${top}/lib/xmlgraphics-commons-1.2.jar" todir="${jars}"/>
    </target>
</project>
