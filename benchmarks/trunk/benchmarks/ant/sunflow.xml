<project name="sunflow" default="all" basedir="..">

    <description>Dacapo Sunflow benchmark</description>
	<property file="ant/dacapo.properties"/>
	
    <property name="sunflow.version" value="0.07.1"/>
    <property name="sunflow.url" value="${sourceforge.dl.url}/sunflow"/>
    
    <!-- Download and build -->
    <target name="all" description="download and build the benchmark">
      <antcall target="source"/>
      <antcall target="build"/>
    </target>
	
    <target name="source">
    	<ant antfile="${ant.dir}/janino.xml" target="source"/>
        <get src="${sunflow.url}/sunflow-src-v${sunflow.version}.zip"
         dest="${sources}/sunflow-src-v${sunflow.version}.zip"
       usetimestamp="true"/>
        <get src="${sunflow.url}/sunflow-bin-v${sunflow.version}.zip"
         dest="${sources}/sunflow-bin-v${sunflow.version}.zip"
       usetimestamp="true"/>
    </target>

    <target name="build" depends="harness,benchmark"/>
    
    <!-- Build the sunflow dacapo harness -->
    <target name="harness" description="--> Build the sunflow dacapo harness">
        <javac srcdir="${bmsrc}" source="1.5" classpath="${build}" destdir="${build}" 
            includes="dacapo/sunflow/*"
            debug="true" debuglevel="lines,vars,source"/>
    </target>
    
    <!-- Build the sunflow benchmark -->
    <target name="benchmark" description="--> Build the sunflow benchmark">

        <property name="sunflow-top" value="${build.src}/sunflow"/>
        <mkdir dir="${sunflow-top}/build"/>

        <!-- Expand the sunflow distribution zipfile -->
        <unzip src="${sources}/sunflow-src-v${sunflow.version}.zip" dest="${build.src}/sunflow"/>

        <!-- Build using javac, setting the classpath appropriately -->
        <javac srcdir="${sunflow-top}/src" source="1.5" classpath="${sunflow-top}/janino.jar" destdir="${sunflow-top}/build"
            debug="true" debuglevel="lines,vars,source"/>

        <!-- Extract the sunflow data from the binary dist -->
        <unzip src="${sources}/sunflow-bin-v${sunflow.version}.zip" dest="${sunflow-top}"/>
        <unjar src="${sunflow-top}/sunflow.jar" dest="${sunflow-top}">
            <patternset>
                <include name="resources/golden_*.png"/>
            </patternset>
        </unjar>

        <!-- Build the jar file used at runtime -->
        <jar destfile="${jars}/sunflow-${sunflow.version}.jar">
            <fileset dir="${sunflow-top}/build">
            	<include name="**/*.class"/>
        	</fileset>
            <fileset dir="${sunflow-top}">
                <include name="resources/golden_*.png"/>
        	</fileset>
        </jar>
    </target>
</project>