<project name="batik" default="all" basedir="..">
    <description>Dacapo Batik benchmark</description>
	<property file="ant/dacapo.properties"/>
	
    <property name="batik.major.version" value="1.7"/>
    <property name="batik.version" value="${batik.major.version}beta1"/>
    <property name="batik.url" value="${apache.dl.url}/xmlgraphics/batik"/>

    <target name="source">
        <get src="${batik.url}/batik-src-${batik.version}.zip"
         dest="${sources}/batik-src-${batik.version}.zip"
         usetimestamp="true"/>
    </target>
    
    <!-- Download and build -->
    <target name="all" description="download and build the benchmark">
      <antcall target="source"/>
      <antcall target="build"/>
    </target>
	
    <target name="build" depends="harness,benchmark"/>
    
    <target name="harness" description="Build batik">
        <javac srcdir="${bmsrc}" classpath="${build}" destdir="${build}"
                includes="dacapo/batik/*"
            debug="true" debuglevel="lines,vars,source"/>
    </target>
    
    <target name="benchmark" description="Build batik">
        <property name="batik-top" value="${build.src}/batik/batik-${batik.major.version}"/>

        <mkdir dir="${build.src}/batik"/>

        <!-- unpack the source files -->
    	<unzip src="${sources}/batik-src-${batik.version}.zip" dest="${build.src}/batik/"/>

        <!-- Build using the supplied build.xml -->
        <ant antfile="build.xml" dir="${batik-top}" 
                     target="all-jar" inheritall="false">
          <property name="debug" value="on"/>
        </ant>

        <!-- Copy the batik jar files -->
        <copy file="${batik-top}/batik-${batik.major.version}/lib/batik-all.jar" todir="${jars}"/>
		<copy file="${batik-top}/lib/build/crimson-1.1.3.jar" todir="${jars}"/>
        <copy file="${batik-top}/lib/xml-apis-ext.jar" todir="${jars}"/>
		<copy file="${batik-top}/lib/xerces_2_5_0.jar" todir="${jars}"/>

        <!-- copy dependencies into build.deps directory -->
        <copy file="${batik-top}/lib/js.jar" todir="${build.deps}"/>
        <copy file="${batik-top}/lib/pdf-transcoder.jar" todir="${build.deps}"/>

        <!-- Copy the batik resource files -->
        <!-- <copy todir="${build}">
            <fileset dir="${batik-top}/resources" excludes="${batik-top}/resources/**/CVS">
                <include name="**"/>
            </fileset>
        </copy> -->

        <!-- Install the test data -->
        <zip basedir="${data}"
         includes="batik/**"
         destfile="${zipdata}/batik.zip"/>

    </target>
    
</project>
