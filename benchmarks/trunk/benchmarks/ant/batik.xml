<project name="batik" default="all" basedir="..">
    <description>Dacapo Batik benchmark</description>
	<property file="ant/dacapo.properties"/>
	
	<property name="bm-name" value="batik"/>
    <property name="batik.major.version" value="1.7"/>
    <property name="bm-version" value="${batik.major.version}beta1"/>
	<property name="bm-src" value="${bm-name}-src-${bm-version}.zip"/>
    <property name="bm-url" value="${apache.dl.url}/xmlgraphics/batik"/>
	<property name="bm-top" value="${build.src}/${bm-name}"/>
	<property name="bm-files" value="${basedir}/${bm-name}"/>

    <target name="source">
        <get src="${bm-url}/${bm-src}" dest="${sources}/${bm-src}" usetimestamp="true"/>
    </target>
    
    <!-- Download and build -->
    <target name="all" description="download and build the benchmark">
      <antcall target="source"/>
      <antcall target="build"/>
    </target>
	
    <target name="build" depends="harness,benchmark"/>
    
    <target name="harness" description="Build batik">
        <copy file="${bm-files}/${bm-name}.cnf" todir="${build}/cnf"/>
       <javac srcdir="${bmsrc}" classpath="${build}" destdir="${build}"
                includes="dacapo/batik/*"
            debug="true" debuglevel="lines,vars,source"/>
    </target>
    
    <target name="benchmark" description="Build batik">
        <property name="batik-top" value="${bm-top}/batik-${batik.major.version}"/>
        <mkdir dir="${bm-top}"/>

        <!-- unpack the source files -->
    	<unzip src="${sources}/${bm-src}" dest="${bm-top}"/>

        <!-- Build using the supplied build.xml -->
        <ant antfile="build.xml" dir="${batik-top}" 
                     target="all-jar" inheritall="false">
          <property name="debug" value="on"/>
        </ant>

        <!-- Copy the batik jar files -->
        <copy file="${batik-top}/batik-${batik.major.version}/lib/batik-all.jar" todir="${jars}"/>
		<copy file="${batik-top}/lib/build/crimson-1.1.3.jar" todir="${jars}"/>
        <copy file="${batik-top}/lib/xalan-2.6.0.jar" todir="${jars}"/>
    	<copy file="${batik-top}/lib/xerces_2_5_0.jar" todir="${jars}"/>
    	<copy file="${batik-top}/lib/xml-apis.jar" todir="${jars}"/>
        <copy file="${batik-top}/lib/xml-apis-ext.jar" todir="${jars}"/>

        <!-- copy dependencies into build.deps directory -->
        <copy file="${batik-top}/lib/js.jar" todir="${build.deps}"/>
        <copy file="${batik-top}/lib/pdf-transcoder.jar" todir="${build.deps}"/>

        <!-- Install the test data -->
        <zip basedir="${data}" includes="${bm-name}/**" destfile="${zipdata}/${bm-name}.zip"/>
    </target>
    
</project>
